<!DOCTYPE html>
<html lang="it">

	<head>
		<title>Grafici</title>
		<link rel="icon" type="image/x-icon" href="../img/logo.png">
		<meta charset="utf-8"/>
		<meta content="width=device-width, initial-scale=1" name="viewport"/>
		<link href="../css/generale.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="../script/accesso.js"></script>
		
		<script>
			if(controlloValidit√†()==false) window.location.href = "login.html";
		</script>
	</head>
	
	<body>
		
	
	
		<!-- navbar con tasti e logo -->
		<div data-collapse="medium" data-animation="default" data-duration="400" role="banner" class="navigation-bar w-nav">
			<div class="w-container">
				
				<!-- logo -->
				<a href="../index.html" aria-current="page" class="brand-link w-nav-brand w--current">
					<h1 class="brand-text">ARDOS</h1>
				</a>
				
				<!-- tasti -->
				<nav role="navigation" class="navigation-menu w-nav-menu">
					<a href="../index.html" aria-current="page" class="navigation-link w-nav-link">Home</a>
					<a href="payments.html" class="navigation-link w-nav-link">Pagamenti</a>
					<a href="#" class="navigation-link w-nav-link w--current">Grafici</a>
					<a href="cronologia.html" class="navigation-link w-nav-link">Cronologia</a>
					<a href="account.html" class="navigation-link w-nav-link ">Account</a>
					<a onclick="logout()" class="navigation-link w-nav-link">logout</a>
				</nav>
				
				<!-- per telefono -->
				<input type="checkbox" id="hamburger-input" />
				<label id="hamburger-menu" for="hamburger-input">
				  <nav id="sidebar-menu">
					<ul>
					  <li><a href="../index.html" >Home</a></li>
					  <li><a href="payments.html">Pagamenti</a></li>
					  <li><a href="#"  class="posizione" >Grafici</a></li>
					  <li><a href="cronologia.html">Cronologia</a></li>
					  <li><a href="account.html">Acount</a></li>
					  <li><a onclick="logout()">Log-out</a></li>
					</ul>
				  </nav>
				</label>
			</div>
		</div>
		
		<script>
			var gas;
			var luce;
			
			function getMonthCon(anno,token){
				gas = [0,0,0,0,0,0,0,0,0,0,0,0,0];
				luce = [0,0,0,0,0,0,0,0,0,0,0,0,0];
				var xmlHttp = new XMLHttpRequest();
				xmlHttp.onreadystatechange = function() { 
					if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
						var r1=xmlHttp.responseText;
						var r2=JSON.parse(r1);
						for (let i = 0; i < r2.length; i++){
							let mont = parseInt(r2[i].data_inizio.split("-")[1])-1;
							
							if(r2[i].type == 'GAS'){
								gas[mont] = parseInt(r2[i].consumo)+ parseInt(gas[mont]);
							}
							else if (r2[i].type == 'LUC'){
								luce[mont] = parseInt(r2[i].consumo)+ parseInt(luce[mont]);
							}
						}
						myChart.update();
					}
				}
				xmlHttp.open("GET", "https://local.marconivr.it/ardos/API/consumi/"+anno+"?jwt="+token, true); // true for asynchronous 
				xmlHttp.setRequestHeader("Content-Type", "application/json");
				xmlHttp.send(null);
			}
			var token = sessionStorage.getItem("token");
			var anno = new Date().getFullYear();
			getMonthCon(anno,token);
			</script>
		
		
		<div class="section">
			<h1 id="anno"></h1>
			<script>document.getElementById("anno").innerHTML = anno;</script>
			<div style="margin: auto; width: 60%; padding: 10px;">
			  <canvas id="myChart"></canvas>
			</div>
			<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
			<script>
			  const labels = [
				'Gennaio',
				'Febbraio',
				'Marzo',
				'Aprile',
				'Maggio',
				'Giugno',
				'Luglio',
				'Agosto',
				'Settembre',
				'Ottobre',
				'Novembre',
				'Dicembre'
			  ];

			  const data = {
				labels: labels,
				datasets: [{
				  label: 'GAS',
				  backgroundColor: 'rgb(132, 133, 126)',
				  borderColor: 'rgb(132, 133, 126)',
				  data: gas,
				}, 
				{
				  label: 'LUCE',
				  backgroundColor: 'rgb(239, 255, 10)',
				  borderColor: 'rgb(239, 255, 10)',
				  data: luce,
				}]
			  };

			  const config = {
				type: 'bar',
				data: data,
				options: {}
			  };
			</script>

			<script>
			  const myChart = new Chart(
				document.getElementById('myChart'),
				config
			  );
			</script>

		</div>
		
		
		
		<!-- footer con link -->
		<div class="footer">
			<div class="w-container">
				<div class="w-row">
					<div class="spc w-col w-col-4">
						<h5>In riguardo ad Ardos</h5>
						<p>Nato come progetto scolastico con la collaborazione di Terranova.<br>
						membri del gruppo: Soffiati Lorenzo, Ferrari Francesco, Barascu Umberto, Aldrighetti Maximo, Ilievski andrej</p>
					</div>
					<div class="spc w-col w-col-4">
						<h5>Link utili</h5>
						<a href="contact.html" class="footer-link">Contattaci</a>
						<a href="login.html" class="footer-link">Login</a>

					</div>
					<div class="w-col w-col-4">
						<h5>Social</h5>
						<div class="footer-link-wrapper w-clearfix">
							<img src="https://assets.website-files.com/5e4b18feebfd1a721bb930e6/5e4b18feebfd1a3b71b93135_social-18.svg" width="20" alt="" class="info-icon"/>
							<a href="#" class="footer-link with-icon">Twitter</a>
						</div>
						<div class="footer-link-wrapper w-clearfix">
							<img src="https://assets.website-files.com/5e4b18feebfd1a721bb930e6/5e4b18feebfd1a0b47b9311e_social-03.svg" width="20" alt="" class="info-icon"/>
							<a href="#" class="footer-link with-icon">Facebook</a>
						</div>				
					</div>
				</div>
			</div>
		</div>
		
	</body>
</html>
