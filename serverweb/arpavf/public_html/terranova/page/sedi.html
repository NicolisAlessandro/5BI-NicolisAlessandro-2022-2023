<!DOCTYPE html>
<html lang="it">

	<head>
		<title>Sede</title>
		<link rel="icon" type="image/x-icon" href="../img/logo.png">
		<meta charset="utf-8"/>
		<meta content="width=device-width, initial-scale=1" name="viewport"/>
		<link href="../css/generale.css" rel="stylesheet" type="text/css"/>
		<link href="../css/sezioni.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="../script/accesso.js"></script>
		
		<script>
			if(controlloValidit√†()==false) window.location.href = "login.html";
		</script>
	</head>
	
	<body>
	
		<!-- navbar con tasti e logo -->
		<div data-collapse="medium" data-animation="default" data-duration="400" role="banner" class="navigation-bar w-nav">
			<div class="w-container">
				
				<!-- logo -->
				<a href="../index.html" aria-current="page" class="brand-link w-nav-brand w--current">
					<h1 class="brand-text">ARDOS</h1>
				</a>
				
				<!-- tasti -->
				<nav role="navigation" class="navigation-menu w-nav-menu">
					<a href="../index.html" aria-current="page" class="navigation-link w-nav-link">Home</a>
					<a href="payments.html" class="navigation-link w-nav-link">Pagamenti</a>
					<a href="graphs.html" class="navigation-link w-nav-link">Grafici</a>
					<a href="cronologia.html" class="navigation-link w-nav-link">Cronologia</a>
					<a href="account.html" class="navigation-link w-nav-link w--current">Account</a>
					<a onclick="logout()" class="navigation-link w-nav-link">logout</a>
				</nav>
				
				<!-- per telefono -->
				<input type="checkbox" id="hamburger-input" />
				<label id="hamburger-menu" for="hamburger-input">
				  <nav id="sidebar-menu">
					<ul>
					  <li><a href="../index.html" >Home</a></li>
					  <li><a href="payments.html">Pagamenti</a></li>
					  <li><a href="graphs.html">Grafici</a></li>
					  <li><a href="cronologia.html">Cronologia</a></li>
					  <li><a href="account.html" class="posizione" >Acount</a></li>
					  <li><a onclick="logout()">Log-out</a></li>
					</ul>
				  </nav>
				</label>
			</div>
		</div>
		
		
			<script>const params = new URL(window.location.href).searchParams;</script>
		<!-- Dati Dell'utente -->
		<div class="section">
			
			<!-- Raccolta dati Sede -->
			<script>
				function getSede(id,token){
					var xmlHttp = new XMLHttpRequest();
					xmlHttp.onreadystatechange = function() { 
						if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
							var r2=JSON.parse(xmlHttp.responseText);
							document.getElementById("myDIV").classList.remove("loader");
							var testo = '<form id="sede" name="sede-form" class="form user_box">';
							testo+='<input type="text" class="form-field w-input user_info" maxlength="256" name="indirizzo" data-name="indirizzo" value="'+r2[0].indirizzo+'" id="indirizzo" required="" readonly/>';
							testo+='<div class="w-row">';
							testo+='	<input type="text" class="user_info form-field w-input w-col w-col-6" maxlength="40" name="citta" data-name="citta" value="'+r2[0].citta+'" id="citta" required="" readonly/>';
							testo+='	<input type="text" class="form-field w-input user_info w-col w-col-6" style="margin-left: 15%" maxlength="40" name="cap" data-name="cap" value="'+r2[0].cap+'" id="cap" required="" readonly/>';
							testo+='</div>';
							testo+='<input type="text" class="form-field w-input user_info" style="width: 65% !important" name="descrizione" data-name="descrizione" value="'+r2[0].descrizione+'" id="descrizione" required="" readonly/>';
							testo+='</form>';
							document.getElementById("box").innerHTML = testo;
						}
					}
					xmlHttp.open("GET", "https://local.marconivr.it/ardos/API/sedi/"+id+"?jwt="+token, true); // true for asynchronous 
					xmlHttp.setRequestHeader("Content-Type", "application/json");
					xmlHttp.send(null);
				}
				var token = sessionStorage.getItem("token");
				getSede(params.get('id'),token);
			</script>	
		
			<!-- Sede -->
			<h1>Sede</h1>
			<center><div class="loader" id="myDIV"></div></center>
			<div id="box"></div>
			
			<br>
			<hr>
			<br>
			
			<!-- Contratti -->
			<h1>Contratti</h1>
			
			
			<form id="prodotto" name="prodotto-form" class="form user_box">
				<h2 style="margin-left: -76%">Gas</h2>
				
				<center><div class="loader" id="myDIV2"></div></center>
				<div id="box2"></div>
			</form>
			
			<form id="prodotto" name="prodotto-form" class="form user_box">
				<h2 style="margin-left: -76%">Luce</h2>
				
				<center><div class="loader" id="myDIV3"></div></center>
				<div id="box3"></div>
			</form>
		</div>
		<script>
				function getContratto(id,token){
					var xmlHttp = new XMLHttpRequest();
					xmlHttp.onreadystatechange = function() { 
						if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
							var r2=JSON.parse(xmlHttp.responseText);
							var testo2 = "";
							var testo3 = "";
							for (let i = 0; i < r2.length; i++){
								var pid = r2[i].PID;
								var type;
								var xmlHttp1 = new XMLHttpRequest();
									xmlHttp1.onreadystatechange = function(){
										if (xmlHttp1.readyState == 4 && xmlHttp1.status == 200){
											type = JSON.parse(xmlHttp1.responseText)[0].type;
										}
									}
									xmlHttp1.open("GET", "https://local.marconivr.it/ardos/API/prodotti/" + pid, false);
									xmlHttp1.setRequestHeader("Content-Type", "application/json");
									xmlHttp1.send(null);
								if(type == "LUC"){
									testo3+='<div class="w-row"><input type="text" class="user_info form-field w-input w-col w-col-6" maxlength="40" name="inizio" value="'+r2[i].data_inizio+'" id="inizio" required="" readonly/>';
									testo3+='<input type="text" class="form-field w-input user_info w-col w-col-6" style="margin-left: 15%" name="fine" value="'+r2[i].data_fine+'" id="fine" required="" readonly/></div>';
								}else if (type == "GAS"){
									testo2+='<div class="w-row"><input type="text" class="user_info form-field w-input w-col w-col-6" maxlength="40" name="inizio" value="'+r2[i].data_inizio+'" id="inizio" required="" readonly/>';
									testo2+='<input type="text" class="form-field w-input user_info w-col w-col-6" style="margin-left: 15%" name="fine" value="'+r2[i].data_fine+'" id="fine" required="" readonly/></div>';
								}
							}
							
							document.getElementById("box2").innerHTML = testo2;//gas
							document.getElementById("box3").innerHTML = testo3;//luce
							document.getElementById("myDIV2").classList.remove("loader");
							document.getElementById("myDIV3").classList.remove("loader");
						}
					}
					xmlHttp.open("GET", "https://local.marconivr.it/ardos/API/contratti?sede="+id+"&jwt="+token, false); // true for asynchronous 
					xmlHttp.setRequestHeader("Content-Type", "application/json");
					xmlHttp.send(null);
				}
				var token = sessionStorage.getItem("token");
				getContratto(params.get('id'),token);
			</script>
			
		
		
		<!-- footer con link -->
		<div class="footer">
			<div class="w-container">
				<div class="w-row">
					<div class="spc w-col w-col-4">
						<h5>In riguardo ad Ardos</h5>
						<p>Nato come progetto scolastico con la collaborazione di Terranova.<br>
						membri del gruppo: Soffiati Lorenzo, Ferrari Francesco, Barascu Umberto, Aldrighetti Maximo, Ilievski andrej</p>
					</div>
					<div class="spc w-col w-col-4">
						<h5>Link utili</h5>
						<a href="contact.html" class="footer-link">Contattaci</a>
						<a href="login.html" class="footer-link">Login</a>

					</div>
					<div class="w-col w-col-4">
						<h5>Social</h5>
						<div class="footer-link-wrapper w-clearfix">
							<img src="https://assets.website-files.com/5e4b18feebfd1a721bb930e6/5e4b18feebfd1a3b71b93135_social-18.svg" width="20" alt="" class="info-icon"/>
							<a href="#" class="footer-link with-icon">Twitter</a>
						</div>
						<div class="footer-link-wrapper w-clearfix">
							<img src="https://assets.website-files.com/5e4b18feebfd1a721bb930e6/5e4b18feebfd1a0b47b9311e_social-03.svg" width="20" alt="" class="info-icon"/>
							<a href="#" class="footer-link with-icon">Facebook</a>
						</div>				
					</div>
				</div>
			</div>
		</div>
		
	</body>
</html>
